(function(){"use strict";var e={6112:function(e,t,n){var o=n(144),a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],r=n(1001),s={},d=(0,r.Z)(s,a,i,!1,null,null,null),c=d.exports,l=n(4720),u=n.n(l),p=n(8345),f=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("HelloWorld",{attrs:{msg:"Welcome to Your Vue.js App"}})],1)},m=[],v=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-header",[t("HeaghtListVue")],1),t("el-main",[t("webrtcdemo")],1)],1)],1)},h=[],g=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"container"},[e._m(0),t("br"),t("div",{staticClass:"buttonlist"},[t("el-input",{attrs:{id:"userName",placeholder:"请输入手机号"},model:{value:e.input1,callback:function(t){e.input1=t},expression:"input1"}}),t("el-button",{attrs:{id:"startConn",type:"primary",size:"default"}},[e._v("连接")]),t("el-input",{attrs:{id:"roomName",placeholder:"请输入房间号"},model:{value:e.input2,callback:function(t){e.input2=t},expression:"input2"}}),t("el-button",{attrs:{id:"joinRoom",type:"primary",size:"default"}},[e._v("加入房间")]),t("el-button",{attrs:{id:"hangUp",type:"danger",size:"default"}},[e._v("挂断")]),t("el-button",{attrs:{id:"hangUp",size:"default",disabled:e.disabled.start},on:{click:e.start}},[e._v("开始录制")]),t("el-button",{attrs:{id:"hangUp",size:"default",disabled:e.disabled.stop},on:{click:e.stop}},[e._v("结束录制")]),t("el-button",{attrs:{id:"hangUp",size:"default",disabled:e.disabled.download},on:{click:e.download}},[e._v("下载文件")]),t("div",{staticStyle:{width:"40%"}},[t("el-input",{staticStyle:{"margin-left":"2%","margin-right":"2%"},attrs:{id:"despTion",autosize:"",type:"textarea",placeholder:"默认：这是一个例会"},model:{value:e.input3,callback:function(t){e.input3=t},expression:"input3"}})],1)],1),t("div",{staticClass:"video-container",attrs:{id:"videoContainer",align:"center"}})])])},b=[function(){var e=this,t=e._self._c;return t("select",{attrs:{id:"anchorType"}},[t("option",{attrs:{value:"摄像头"}},[e._v("摄像头")]),t("option",{attrs:{value:"屏幕共享"}},[e._v("屏幕共享")])])}],y=(n(7658),{data(){return{input1:"",input2:"",input3:"这是一个例会",stream:null,mediaRecorder:null,chunks:[],recording:null,disabled:{start:!1,stop:!0,download:!0}}},mounted(){this.webrtc()},methods:{openScreenCapture(){return navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}):navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}})},async start(){this.disabled.start=!0,this.disabled.stop=!1,this.disabled.download=!0,this.recording&&window.URL.revokeObjectURL(this.recording),this.stream=await this.$options.methods.openScreenCapture(),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"video/webm;codecs=vp8"}),this.mediaRecorder.addEventListener("dataavailable",(e=>{e.data&&e.data.size>0&&this.chunks.push(e.data)})),this.mediaRecorder.start(10)},stop(){this.disabled.start=!0,this.disabled.stop=!0,this.disabled.download=!1,this.mediaRecorder.stop(),this.mediaRecorder=null,this.stream.getTracks().forEach((e=>e.stop())),this.stream=null,this.recording=window.URL.createObjectURL(new Blob(this.chunks,{type:"video/webm"}))},download(){console.log(this.recording),this.disabled.start=!1,this.disabled.stop=!0,this.disabled.download=!0;let e=document.createElement("a");e.style.display="none",e.href=this.recording,e.setAttribute("download","load.webm"),document.body.appendChild(e),e.click()}}}),w=y,k=(0,r.Z)(w,g,b,!1,null,null,null),O=k.exports,_=function(){var e=this;e._self._c;return e._m(0)},C=[function(){var e=this,t=e._self._c;return t("div",[t("h2",[e._v("多人音视频通话")])])}],N={data(){return{value:null}},mounted(){},methods:{}},E=N,S=(0,r.Z)(E,_,C,!1,null,null,null),T=S.exports,R={data(){return{}},components:{webrtcdemo:O,HeaghtListVue:T},mounted(){this.webrtc()},methods:{}},j=R,I=(0,r.Z)(j,v,h,!1,null,null,null),L=I.exports,D={name:"HomeView",components:{HelloWorld:L}},A=D,x=(0,r.Z)(A,f,m,!1,null,null,null),U=x.exports;o["default"].use(p.ZP);const B=[{path:"/",name:"home",component:U},{path:"/about",name:"about",component:()=>n.e(443).then(n.bind(n,5399))}],M=new p.ZP({routes:B});var Z=M,V=n(6154);const P="http://47.103.223.106:5000";var z={install(e){e.prototype.webrtc=function(){const e=document.getElementById("userName"),t=document.getElementById("roomName"),n=document.getElementById("despTion"),o=document.getElementById("startConn"),a=document.getElementById("joinRoom"),i=document.getElementById("hangUp"),r=document.getElementById("videoContainer"),s=document.getElementById("anchorType");let d="1";s.onchange=function(e){d="摄像头"===e.target.value?"1":"2"},t.disabled=!0,a.disabled=!0,i.disabled=!0;var c,l,u=[],p={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]},{urls:"turn:1.15.177.18:3478",credential:"030318",username:"Zzl"}]};const f={offerToReceiveVideo:1,offerToReceiveAudio:1},m="http:"===location.protocol?"ws://":"wss://";function v(e,t){const n=new RTCPeerConnection(p);return u.push({userName:e,pc:n}),c.getTracks().forEach((e=>n.addTrack(e,c))),t&&(n.createOffer(f).then((function(t){n.setLocalDescription(t);const o=JSON.stringify({type:"signalOffer",offer:t,userName:e});l.send(o)})),n.addEventListener("icecandidate",(function(t){const n=t.candidate;if(n){const t=JSON.stringify({type:"iceOffer",iceCandidate:n,userName:e});l.send(t)}}))),n}function h(e,t){v(e[t],!0),t++,e.length>t&&h(e,t)}function g(e){const{offer:t,sourceName:n,streamId:o}=e;k(n,o);const a=v(n);a.setRemoteDescription(new RTCSessionDescription(t)),a.createAnswer().then((function(e){a.setLocalDescription(e);const t=JSON.stringify({type:"signalAnswer",answer:e,userName:n});l.send(t)})),a.addEventListener("addstream",(function(e){document.getElementById(e.stream.id).srcObject=e.stream})),a.addEventListener("icecandidate",(function(e){const t=e.candidate;if(t){const e=JSON.stringify({type:"iceOffer",iceCandidate:t,userName:n});l.send(e)}}))}function b(e){const{answer:t,sourceName:n,streamId:o}=e;k(n,o);const a=u.find((e=>e.userName===n));if(a){const{pc:e}=a;e.setRemoteDescription(new RTCSessionDescription(t)),e.addEventListener("addstream",(function(e){document.getElementById(e.stream.id).srcObject=e.stream}))}}function y(e){const{iceCandidate:t,sourceName:n}=e,o=u.find((e=>e.userName===n));if(o){const{pc:e}=o;e.addIceCandidate(new RTCIceCandidate(t))}}function w(e){const{sourceName:t,streamId:n}=e,o=u.findIndex((e=>e.userName===t));o>-1&&u.splice(o,1),O(n)}function k(e,t,n){const o=document.createElement("div");o.id=t+"_item",o.className="video-item";const a=document.createElement("span");a.className="video-title",a.innerHTML=e,o.appendChild(a);const i=document.createElement("video");i.id=t,i.className="video-play",i.controls=!0,i.autoplay=!0,i.muted=!0,i.webkitPlaysinline=!0,n&&(i.srcObject=n),o.appendChild(i),r.appendChild(o)}function O(e){r.removeChild(document.getElementById(e+"_item"))}o.onclick=async function(){if(console.log("开始连接"),""==e.value)return void alert("请输入手机号码");const r=e.value,s=n.value;console.log(s);try{const t=`${P}/Videouser/userfind`,n={phone:r},o={headers:{Accept:"*/*"}},a=await V.Z.post(t,null,{params:n,...o});if(console.log(a.data),0==a.data.data)return alert("该手机号码不存在，请重新输入"),void(e.value="")}catch(d){return void console.error(d)}l=new WebSocket(m+location.host),l.onopen=t=>{console.log(t),console.log("connent WebSocket is ok");const n=JSON.stringify({type:"conn",userName:e.value});l.send(n)},l.onmessage=n=>{console.log(n);const r=n.data.toString(),s=JSON.parse(r);switch(s.type){case"conn":console.log("连接成功"),e.disabled=!0,o.disabled=!0,t.disabled=!1,a.disabled=!1,i.disabled=!1;break;case"room":h(s.roomUserList,0);break;case"signalOffer":g(s);break;case"signalAnswer":b(s);break;case"iceOffer":y(s);break;case"close":w(s);default:break}}},a.onclick=async function(){if(console.log("触发函数"),""==e.value)return void alert("请输入用户名");const o=t.value,i=0,r=e.value,s=n.value;console.log(s);try{const t=`${P}/Videouser/userfind`,n={phone:r},o={headers:{Accept:"*/*"}},a=await V.Z.post(t,null,{params:n,...o});if(console.log(a.data),0==a.data.data)return alert("该手机号码不存在，请重新输入"),void(e.value="")}catch(f){return void console.error(f)}try{const e=`${P}/Videouser/addUserVideo`,t={userphone:r,videoid:o},n={headers:{Accept:"*/*"}},a=await V.Z.post(e,null,{params:t,...n});console.log(a.data.data)}catch(f){console.error(f)}try{const e=`${P}/video/updateoraddVideo`,t={videoId:o,opera:i,descrip:s},a={headers:{Accept:"*/*"}},r=await V.Z.post(e,null,{params:t,...a});console.log(r.data.data),n.value=r.data.data}catch(f){console.error(f)}const u={video:!0,audio:{noiseSuppression:!0,echoCancellation:!0}},p="1"===d?navigator.mediaDevices.getUserMedia(u):navigator.mediaDevices.getDisplayMedia(u);p.then((function(n){c=n,k(e.value,c.id,c);const o=JSON.stringify({type:"room",roomName:t.value,streamId:c.id});l.send(o),t.disabled=!0,a.disabled=!0})).catch((function(e){console.log(JSON.stringify(e))}))},i.onclick=async function(){console.log("hangUp");const s=t.value,d=1,p=n.value;try{const e=`${P}/video/updateoraddVideo`,t={videoId:s,opera:d,descrip:p},n={headers:{Accept:"*/*"}},o=await V.Z.post(e,null,{params:t,...n});console.log(o.data)}catch(f){console.error(f)}e.disabled=!1,o.disabled=!1,t.disabled=!0,a.disabled=!0,i.disabled=!0,c&&(c.getTracks().forEach((e=>e.stop())),c=null),u.forEach((e=>{e.pc.close(),e.pc=null})),u.length=0,l&&(l.close(),l=null),r.innerHTML=""}}}};o["default"].use(z),o["default"].use(u()),o["default"].config.productionTip=!1,new o["default"]({router:Z,render:e=>e(c)}).$mount("#app")}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,o,a,i){if(!o){var r=1/0;for(l=0;l<e.length;l++){o=e[l][0],a=e[l][1],i=e[l][2];for(var s=!0,d=0;d<o.length;d++)(!1&i||r>=i)&&Object.keys(n.O).every((function(e){return n.O[e](o[d])}))?o.splice(d--,1):(s=!1,i<r&&(r=i));if(s){e.splice(l--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[o,a,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,o){return n.f[o](e,t),t}),[]))}}(),function(){n.u=function(e){return"js/about.a0b4c229.js"}}(),function(){n.miniCssF=function(e){}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="vue-webrtc:";n.l=function(o,a,i,r){if(e[o])e[o].push(a);else{var s,d;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var u=c[l];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+i){s=u;break}}s||(d=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+i),s.src=o),e[o]=[a];var p=function(t,n){s.onerror=s.onload=null,clearTimeout(f);var a=e[o];if(delete e[o],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((function(e){return e(n)})),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),d&&document.head.appendChild(s)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p=""}(),function(){var e={143:0};n.f.j=function(t,o){var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)o.push(a[2]);else{var i=new Promise((function(n,o){a=e[t]=[n,o]}));o.push(a[2]=i);var r=n.p+n.u(t),s=new Error,d=function(o){if(n.o(e,t)&&(a=e[t],0!==a&&(e[t]=void 0),a)){var i=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",s.name="ChunkLoadError",s.type=i,s.request=r,a[1](s)}};n.l(r,d,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,i,r=o[0],s=o[1],d=o[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(d)var l=d(n)}for(t&&t(o);c<r.length;c++)i=r[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(l)},o=self["webpackChunkvue_webrtc"]=self["webpackChunkvue_webrtc"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(6112)}));o=n.O(o)})();
//# sourceMappingURL=app.a951f862.js.map